---
# For security reasons, the workflow in which the autofix.ci action is used must be named "autofix.ci".
name: "autofix.ci"

on:
  push:
    branches:
      - "main"
  pull_request:
    branches: ["*"]

jobs:
  prettier:
    name: "prettier"
    runs-on: "ubuntu-latest"
    env:
      S3_CREDENTIALS: ${{ format('{{
        "endpoint": "{0}",
        "access_key": "{1}",
        "secret_key": "{2}",
        "bucket_name": "{3}"
      }}', secrets.OVH_GHA_CACHE_ENDPOINT, vars.OVH_GHA_CACHE_USER_SECRET_ID, secrets.OVH_GHA_CACHE_USER_SECRET, secrets.OVH_GHA_CACHE_BUCKET_NAME) }}
    steps:
      - uses: "actions/checkout@v5"

      - uses: "bckground/actions/setup-mise/restore@main"
        with:
          s3_credentials: "${{ env.S3_CREDENTIALS }}"

      - uses: "bckground/actions/autofix-prettier@main"

      - if: github.ref_name == 'main'
        uses: bckground/actions/setup-mise/save@main
        with:
          s3_credentials: "${{ env.S3_CREDENTIALS }}"
