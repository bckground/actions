---
name: "save mise setup"

inputs:
  cache-s3-endpoint:
    type: "string"
    required: true
  cache-s3-access-key:
    type: "string"
    required: true
  cache-s3-secret-key:
    type: "string"
    required: true
  cache-s3-bucket-name:
    type: "string"
    required: true

outputs:
  data-dir:
    description: "The path to mise's data directory"
    value: "${{ steps.mise-cache-dirs.outputs.data-dir }}"

runs:
  using: "composite"
  steps:
    - name: "Retrieve mise directories to cache"
      uses: "bckground/actions/setup-mise/internal@main"
      id: "mise-cache-dirs"

    - name: "Save mise directories"
      uses: bckground/actions-cache/save@8a7e86207dc72a3f6bd8cbc23f4f061558fee8f8
      with:
        endpoint: "${{ inputs.cache-s3-endpoint }}"
        accessKey: "${{ inputs.cache-s3-access-key }}"
        secretKey: "${{ inputs.cache-s3-secret-key }}"
        bucket: "${{ inputs.cache-s3-bucket-name }}"
        use-fallback: false
        key: mise-on-${{ runner.os }}-${{ runner.arch }}-${{ github.sha }}
        path: |
          ${{ steps.mise-cache-dirs.outputs.data-dir }}
